{"version":3,"file":"exercise_modal-bac36720.js","sources":["../../src/js/exercise_modal.js"],"sourcesContent":["import { API_EXERCISES_POINT, api } from './api.js';\nimport { notify } from './notifier.js';\n\n// const refs = {\nlet modalCard = document.querySelector('.modal');\nlet closeBtn = document.querySelector('.close-modal-btn');\nlet favBtn = document.querySelector('.add-favorite-btn');\nlet ratingBtn = document.querySelector('.give-rating-btn');\nlet modal = document.querySelector('.backdrop-modal');\nlet loader = document.querySelector('.loader');\n// };\nlet exerciseObject = { isFavorite: false };\n\n// (open modal, get exer)\nexport function openModalHandler(e) {\n  if (\n    !e.target &&\n    !e.target.classList.contains('card-button') &&\n    !e.target.closest('.card-button').classList.contains('card-button')\n  ) {\n    return;\n  }\n\n  let id;\n  try {\n    id = e.target.closest('.card-button').dataset.id;\n  } catch {\n    id = '';\n  }\n\n  // testing\n  // let id = '64f389465ae26083f39b1ab2';\n  if (!id) {\n    return;\n  }\n  document.querySelector('.backdrop-modal').classList.remove('visually-hidden');\n  // let loader = document.querySelector('.loader');\n  // if (loader) {\n  document.querySelector('.modal').innerHTML = '<div class=\"loader-modal\"></div>';\n  document.querySelector('.loader-modal').style.display = 'block';\n  // }\n  openModal(id);\n}\n\n// (hide only modal, backdrop is open)\nexport function hideModalHandler() {}\n// (show only modal, get exer from server)\nexport function showModalHandler() {}\n\n// (closes the modal)\nfunction closeModalHandler() {\n  document.querySelector('.backdrop-modal').classList.add('visually-hidden');\n}\n\nfunction addRemoveFavoriteHandler(e) {\n  if (\n    Object.hasOwn(exerciseObject, 'isFavorite') &&\n    exerciseObject.isFavorite\n  ) {\n    removeFromFavoriteStorage(e);\n    exerciseObject.isFavorite = false;\n    notify('success', 'The exercise has been removed from favorites list');\n  } else {\n    addToFavoriteStorage(e);\n    exerciseObject.isFavorite = true;\n    notify('success', 'The exercise has been added to favorites list');\n  }\n  markupAndReload(exerciseObject);\n}\n// (adds to favorites)\nfunction addToFavoriteStorage(e) {\n  let curFavorites = JSON.parse(localStorage.getItem('favorites')) || [];\n  curFavorites.push(exerciseObject);\n  localStorage.setItem('favorites', JSON.stringify(curFavorites));\n}\n\n// (remove from favorites)\nfunction removeFromFavoriteStorage(e) {\n  const exerciseId = e.target.dataset.id;\n  let curFavorites = JSON.parse(localStorage.getItem('favorites')) || [];\n  let updFavorites = curFavorites.filter(\n    exercise => exercise._id !== exerciseId\n  );\n  localStorage.setItem('favorites', JSON.stringify(updFavorites));\n}\n\nfunction getExerciseFromStorage(id) {\n  if (id) {\n    let itemObj;\n    let exerciseId = id;\n    let curFavorites = JSON.parse(localStorage.getItem('favorites')) || [];\n    itemObj = curFavorites.filter(exercise => exercise._id === exerciseId);\n    exerciseObject.isFavorite = !!itemObj.length;\n    return itemObj;\n  }\n}\n\nfunction openModal(id) {\n  getExerciseFromStorage(id);\n  getExerciseApi(id);\n}\n\nfunction markupAndReload(item) {\n  document.querySelector('.modal').innerHTML = createMarkupExercisesCard(item);\n\n  // refresh all elements after recreate them, and add listeners\n  closeBtn = document.querySelector('.close-modal-btn');\n  closeBtn.addEventListener('click', closeModalHandler);\n\n  favBtn = document.querySelector('.add-favorite-btn');\n  favBtn.addEventListener('click', addRemoveFavoriteHandler);\n\n  ratingBtn = document.querySelector('.give-rating-btn');\n  // ratingBtn.addEventListener('click', openRatingModal);\n}\n\nfunction getExerciseApi(id) {\n  if (!id) {\n    return;\n  }\n\n  api\n    .get(`${API_EXERCISES_POINT}/${id}`, {})\n    .then(data => {\n      if (exerciseObject.isFavorite) {\n        exerciseObject = data;\n        exerciseObject.isFavorite = true;\n      } else {\n        exerciseObject = data;\n        exerciseObject.isFavorite = false;\n      }\n      markupAndReload(data);\n    })\n    .catch(error => notify('error', `API error: ${error}`))\n    .finally(() => {\n      try {\n        document.querySelector('.loader-modal').style.display = 'none';\n      } catch {}\n    });\n}\n\n// this will call from exercises_items and favorite part\n// openModalHandler();\n\nfunction spanToCapitalize(text) {\n  return text.charAt(0).toUpperCase() + text.slice(1);\n}\n\nfunction createMarkupExercisesCard({\n  _id,\n  bodyPart,\n  equipment,\n  gifUrl,\n  name,\n  target,\n  description,\n  rating,\n  burnedCalories,\n  time,\n  popularity,\n  isFavorite,\n}) {\n  let starsGray = 5;\n  let starsOrange = Number(rating.toFixed());\n  starsGray -= starsOrange;\n  let stars = '<r class=\"star-1\"/>'\n    .repeat(starsOrange)\n    .concat('<r class=\"star-0\"/>'.repeat(starsGray));\n  return `<div class=\"modal-description-container\">\n      <button class=\"close-modal-btn\" title=\"Close window\">\n        <svg class=\"close-modal-icon\" width=\"24\" height=\"24\">\n          <use href=\"./img/icons.svg#icon-cross\"></use>\n        </svg>\n      </button>\n      <div class=\"modal-gif-container\">\n        <picture>\n          <source\n            media=\"(max-width:767.98px)\"\n            type=\"image/gif\"\n            width=\"295\"\n            height=\"258\"\n          />\n          <source\n            media=\"(min-width:768px)\"\n            type=\"image/gif\"\n            width=\"270\"\n            height=\"259\"\n          />\n          <img\n            class=\"modal-gif\"\n            src=\"${gifUrl}\"\n            alt=\"${name}\"\n            width=\"295\"\n            height=\"258\"\n          />\n        </picture>\n      </div>\n      <div class=\"text-container\">\n        <h4 class=\"modal-title\">${name}</h4>\n        <div class=\"rating-container\">\n          <div class=\"star-block\">\n          <p class=\"modal-exercises-rating\">${rating.toFixed(1)}</p>\n          ${stars}\n        </div>\n        <ul class=\"description-list\">\n          <li class=\"description-item\">\n            <p>Target</p>\n            <span>${spanToCapitalize(target)}</span>\n          </li>\n          <li class=\"description-item\">\n            <p>Body Part</p>\n            <span>${spanToCapitalize(bodyPart)}</span>\n          </li>\n          <li class=\"description-item\">\n            <p>Equipment</p>\n            <span>${spanToCapitalize(equipment)}</span>\n          </li>\n          <li class=\"description-item\">\n            <p>Popular</p>\n            <span>${popularity}</span>\n          </li>\n          <li class=\"description-item\">\n            <p>Burned Calories</p>\n            <span>${burnedCalories}/${time} min</span>\n          </li>\n        </ul>\n        <p class=\"modal-description-text\">${description}</p>\n        <div class=\"modal-buttons-container\">\n          <button data-id=\"${_id}\" class=\"add-favorite-btn\">\n            ${isFavorite ? 'Remove from' : 'Add to favorites'}\n            <svg class=\"icon-heart\" width=\"18\" height=\"18\">\n              <use href=\"./img/icons.svg#icon-heart\"></use>\n            </svg>\n          </button>\n          <button data-id=\"${_id}\" class=\"give-rating-btn\">\n            Give a rating\n          </button>\n        </div>\n      </div>\n    </div>`;\n}\n"],"names":["closeBtn","favBtn","exerciseObject","openModalHandler","id","openModal","hideModalHandler","showModalHandler","closeModalHandler","addRemoveFavoriteHandler","removeFromFavoriteStorage","notify","addToFavoriteStorage","markupAndReload","curFavorites","exerciseId","updFavorites","exercise","getExerciseFromStorage","itemObj","getExerciseApi","item","createMarkupExercisesCard","api","API_EXERCISES_POINT","data","error","spanToCapitalize","text","_id","bodyPart","equipment","gifUrl","name","target","description","rating","burnedCalories","time","popularity","isFavorite","starsGray","starsOrange","stars"],"mappings":"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"}